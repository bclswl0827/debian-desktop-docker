webpackJsonp([1],{NHnr:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=s("7+uW"),i={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var a=s("VU/8")({name:"App"},i,!1,function(t){s("gsu9")},null,null).exports,r=s("/ocq"),o=s("Xxa5"),c=s.n(o),h=s("exGp"),d=s.n(h),u={name:"Vnc",components:{},data:function(){return{vncState:"stopped",videoState:"stopped",config:{mode:"vnc"},stateID:-1,errorMessage:"",width:0,height:0,videoCurrentTime:0,stateErrorCount:0,timerState:null}},created:function(){window.addEventListener("message",this.onMessage),"video"in this.$route.query&&(this.config.mode="video")},mounted:function(){this.update_status()},beforeDestroy:function(){clearTimeout(this.timerState),window.removeEventListener("message",this.onMessage)},methods:{update_status:function(){var t=d()(c.a.mark(function t(){var e,s,n,i,a,r;return c.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=this.$refs.vncFrame.clientWidth,s=this.$refs.vncFrame.clientHeight,n={video:"video"===this.config.mode,id:this.stateID,w:e,h:s},t.prev=3,t.next=6,this.$http.get("api/state",{params:n});case 6:if(i=t.sent,200===(a=i.data).code){t.next=13;break}if(this.stateErrorCount+=1,!(this.stateErrorCount>10)){t.next=13;break}throw this.errorMessage=this.$t("serviceIsUnavailable"),this.errorMessage;case 13:if(this.stateID=a.data.id,a.data.config.fixedResolution||0!==a.data.config.sizeChangedCount){t.next=24;break}return t.next=17,this.$http.get("api/reset",{params:n});case 17:if(r=t.sent,200===r.data.code){t.next=24;break}if(this.stateErrorCount+=1,!(this.stateErrorCount>10)){t.next=24;break}throw this.errorMessage=this.$t("serviceIsUnavailable"),this.errorMessage;case 24:"stopped"===this.vncState&&this.reconnect(!1),this.schedule_next_update_status(),t.next=32;break;case 28:t.prev=28,t.t0=t.catch(3),this.stateErrorCount+=1,this.stateErrorCount>10?this.errorMessage=this.$t("serviceIsUnavailable"):this.schedule_next_update_status();case 32:case"end":return t.stop()}},t,this,[[3,28]])}));return function(){return t.apply(this,arguments)}}(),schedule_next_update_status:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;null===this.timerState&&(this.timerState=setTimeout(function(){t.timerState=null,t.update_status()},e))},reconnect:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];console.log("connecting..."),this.errorMessage="";var e=location.pathname.substr(1)+"websockify";if(t||"stopped"===this.vncState){this.vncState="connecting";var s=window.location.hostname,n=window.location.port;n||(n="s"===window.location.protocol[4]?443:80);var i="static/vnc.html?";i+="autoconnect=1&",i+="host="+s+"&port="+n+"&",i+="path="+e+"&title=novnc2&",i+="logging=warn",this.$refs.vncFrame.setAttribute("src",i)}if("video"===this.config.mode){if(t||"stopped"===this.videoState){var a="static/video.html?width="+this.$refs.vncFrame.clientWidth+"&height="+this.$refs.vncFrame.clientHeight+"&base="+window.location.host;this.$refs.videoFrame.setAttribute("src",a),this.videoState="connecting"}}else"stopped"!==this.videoState&&(this.$refs.videoFrame.setAttribute("src",""),this.videoState="stopped")},onMessage:function(t){try{var e=JSON.parse(t.data);"flvjs"===e.from&&"event"===e.type&&(console.log(e.eventName),"onSourceOpen"===e.eventName?this.videoState="running":"onSourceEnded"===e.eventName||"onSourceClose"===e.eventName&&(this.videoState="stopped")),"novnc"===e.from&&e.state&&(this.vncState=e.state)}catch(t){}}},computed:{},watch:{}},v={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticStyle:{width:"100%",height:"100%","background-color":"#000"}},[e("iframe",{directives:[{name:"show",rawName:"v-show",value:"video"===this.config.mode,expression:"config.mode === 'video'"}],ref:"videoFrame",staticClass:"frame",attrs:{id:"videoFrame",frameBorder:"0",scrolling:"no"}}),this._v(" "),e("iframe",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],ref:"vncFrame",staticClass:"frame",class:{hiddenvnc:"video"===this.config.mode},attrs:{id:"vncFrame",frameBorder:"0",scrolling:"no"}})])},staticRenderFns:[]};var p=s("VU/8")(u,v,!1,function(t){s("XKXf")},"data-v-27f2f92f",null).exports;n.a.use(r.a);var f=new r.a({mode:"history",base:window.location.pathname,routes:[{path:"/",name:"Vnc",component:p}]}),l=s("mtWM"),m=s.n(l);n.a.config.productionTip=!1,n.a.prototype.$http=m.a,new n.a({el:"#app",router:f,components:{App:a},template:"<App/>"})},XKXf:function(t,e){},gsu9:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.fef011cae8f5fbff4b55.js.map